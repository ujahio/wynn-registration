# File: .github/workflows/ci-and-deploy.yml
name: CI â†’ Test â†’ Deploy

on:
  push:
    branches:
      - main

jobs:
  # lint-and-unit:
  #   name: ğŸ§ª Run Jest unit tests
  #   runs-on: ubuntu-latest
  #   steps:
  #     - uses: actions/checkout@v4
  #     - name: Use Node.js
  #       uses: actions/setup-node@v4
  #       with:
  #         node-version: 20
  #     - name: Install dependencies
  #       run: npm ci
  #     - name: Run unit tests
  #       run: npm run test
e2e-tests:
  name: ğŸŒ Run Playwright E2E tests
  # needs: lint-and-unit
  runs-on: ubuntu-latest
  steps:
    - uses: actions/checkout@v4
    - name: Use Bun
      uses: oven-sh/setup-bun@v1
      with:
        bun-version: latest
    - name: Install dependencies
      run: bun install --frozen-lockfile
    - name: Install Playwright browsers
      run: bun playwright install --with-deps
    - name: Build Next.js
      run: bun run build
    - name: Start server in background
      run: |
        bun run start:ci &
        # wait for Next.js to be up
        bunx --bun wait-on http://localhost:3000
    - name: Run Playwright tests
      run: bun run test:e2e
# deploy:
#   name: ğŸš€ Deploy to Vercel
#   # needs: e2e-tests
#   runs-on: ubuntu-latest
#   steps:
#     - uses: actions/checkout@v4
#     - name: Use Bun
#       uses: oven-sh/setup-bun@v1
#     - name: Install dependencies
#       run: bun install --frozen-lockfile
#     - name: Deploy to Vercel
#       uses: amondnet/vercel-action@v20
#       with:
#         vercel-token: ${{ secrets.VERCEL_TOKEN }}
#         vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
#         vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
#         working-directory: .
#         prod: true
